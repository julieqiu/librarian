# Reference librarian.yaml Configuration
# This file serves as the specification and example for the librarian.yaml schema.

# --- Global Repository Context ---
language: rust
repo: googleapis/google-cloud-rust

# --- Global Tooling Configuration ---
tools:
  preinstalled: # Tools expected to be in PATH
    - cargo
    - git
  cargo:        # Tools to be dynamically installed via cargo
    - name: cargo-semver-checks
      version: 0.44.0
    - name: cargo-workspaces
      version: 0.4.0
  # ... other tool installers (e.g., pip)


# --- Global Generation Configuration ---
# Settings and inputs that apply to the code generation process globally.
generation:
  output: src/generated/       # Default root output for generated code
  release_level: stable        # Default release level (e.g., "stable", "preview")
  transport: grpc+rest         # Default transport protocol (e.g., "grpc", "rest", "grpc+rest")

  # External source repositories used as inputs for generation.
  sources:
    googleapis:
      commit: 35365cb31245ac9ee3f3ed37bd052ea246ed732b
      sha256: de0831d253510c43282d607de44b60b650f00a4e3a9f388927fe3db11871f6fa
    protobuf:
      commit: b407e8416e3893036aee5af9a12bd9b6a0e2b2e6
      sha256: 55912546338433f465a552e9ef09930c63b9eb697053937416890cff83a8622d
      subpath: src
    # ... other sources (discovery, showcase, conformance) ...

  # Language-specific generation defaults.
  rust:
    package_dependencies:
      - name: api
        package: google-cloud-api
        source: google.api
      # ... other language-specific defaults ...
    disabled_rustdoc_warnings:
      - redundant_explicit_links
      - broken_intra_doc_links
    generate_setter_samples: true


# --- Global Release Configuration ---
# Settings and policies that apply to the release process across all artifacts.
release:
  branch: main
  remote: upstream
  tag_format: "{name}/v{version}" # Release tagging convention
  ignored_changes:                 # File patterns to ignore when detecting changes for a release
    - .repo-metadata.json
    - .sidekick.toml
  roots_pem: <path-to-roots.pem>    # Optional: Alternative location for `roots.pem` file.


# --- The Single Source of Truth: List of Managed Libraries ---
# Each entry fully defines a library/package, its version, and how Librarian
# interacts with it across both generation and release lifecycles.
libraries:
  # 1. Fully Auto-Generated Library (Default behavior, pulls source from Catalog)
  - name: google-cloud-secretmanager
    version: 1.2.0
    # generate: true (implied by default, absence of 'generate:false' flag)
    # release: true (implied by default, absence of 'release:false' flag)
    # No 'channels' or 'rust.modules' here, implies use Central Catalog for API source details.

  # 2. Hybrid (Veneer) Library (Specific parts generated, rest is handwritten)
  - name: google-cloud-pubsub
    version: 0.32.0
    # generate: true (implied)
    # release: true (implied)
    # The presence of 'rust.modules' defines its generation behavior and makes it a "veneer".
    rust: # Language-specific generation overrides for this library
      modules:
        - source: google/pubsub/v1 # This module's input proto path
          template: prost           # The generator template to use
          output: src/pubsub/src/generated/protos # Where to put *this module's* output
        - source: google/pubsub/v1
          template: grpc-client
          output: src/pubsub/src/generated/gapic
      # ... other language-specific, module-level overrides ...

  # 3. Purely Handwritten Library (Managed for release, but no code generated by Librarian)
  - name: google-cloud-auth
    version: 1.3.0
    generate: false # Explicitly tells Librarian: "DO NOT generate any code for this library."

  # 4. Temporarily Disabled (e.g., due to a breaking bug, pending fix)
  - name: google-cloud-broken
    version: 0.9.0
    generate: false # Do not generate code for this library currently
    release: false  # Do not include this library in release operations currently
    # channels:      # Can still define the source config, even if generation is off
    #   - path: google/cloud/broken/v1
